#!/usr/bin/env python3

from nclib import netcat
import sys
import struct
import re

HEADER_SIZE = 16
DESTINATION_TO_UPDATE_SIZE = 8
EXTERNAL_SIZE = 264
EXPORT_SIZE = 260

def main():
    host = sys.argv[1]
    port = int(sys.argv[2])

    conn = netcat.Netcat((host, port))

    result = conn.recvuntil(b'debug@R3-S1$ ')

    conn.sendline(b"gme")

    result = conn.recvuntil(b'num?')

    conn.sendline(b"9999")
    result = conn.recvuntil(b'num?')

    conn.sendline(b"0")

    result = conn.recvuntil(b'num?')

    result = conn.recv()
    hint = re.search(b'\d+', result)
    hint = hint.group(0)

    hint = int(hint)

    target = 88997722 ^ hint

    target = f"{target}"

    conn.sendline(target.encode())

    result = conn.recvuntil(b'debug@R3-S1$ ')
    flag = re.search(b'OOO{[^}]+}', result)
    print("FLAG: %s" % flag.group(0))
    
    conn.sendline(b"quit")

if __name__ == '__main__':
    main()

